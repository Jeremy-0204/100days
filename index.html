<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>100 Days with Kaitlin</title>
    <style>
        body, html { margin: 0; padding: 0; width: 100%; height: 100%; overflow: hidden; background-color: #fdfbfb; font-family: sans-serif; }
        #start-screen { position: absolute; top: 0; left: 0; width: 100%; height: 100%; z-index: 100; background: white; display: flex; flex-direction: column; justify-content: center; align-items: center; cursor: pointer; }
        #huzzah-img { width: 280px; border-radius: 20px; }
        .click-hint { margin-top: 20px; color: #888; font-weight: bold; }
        #ui-layer { position: absolute; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none; display: flex; justify-content: center; align-items: center; z-index: 10; }
        .chapter-container { position: absolute; bottom: 10%; text-align: center; opacity: 0; transition: opacity 0.5s; }
        .chapter-container.active { opacity: 1; }
        .chapter-container h2 { font-size: 3rem; margin: 0; color: #333; }
        .chapter-container p { color: #d4af37; font-weight: bold; letter-spacing: 2px; }
        #progress-bar { position: absolute; right: 20px; top: 50%; transform: translateY(-50%); width: 4px; height: 0%; background: #d4af37; }
        #progress-bg { position: absolute; right: 20px; top: 50%; transform: translateY(-50%); width: 4px; height: 150px; background: #eee; }
        #canvas-container { position: absolute; top: 0; left: 0; width: 100%; height: 100%; z-index: 1; }
        
        /* Error Log for Debugging */
        #debug-log {
            position: absolute; top: 10px; left: 10px; z-index: 200;
            background: rgba(0,0,0,0.7); color: #ff5555; padding: 10px;
            border-radius: 5px; font-size: 12px; pointer-events: none;
            display: none; /* Hidden by default, shows if error */
        }
    </style>
</head>
<body>

    <div id="debug-log"></div>

    <div id="start-screen" onclick="startGame()">
        <img id="huzzah-img" src="huzzah.gif" onerror="this.src='https://media.giphy.com/media/MdGZp0GkF2L7i/giphy.gif'">
        <div class="click-hint">CLICK ANYWHERE TO START</div>
    </div>

    <div id="ui-layer">
        <div id="chapter-text" class="chapter-container">
            <h2 id="chap-head">Title</h2>
            <p id="chap-sub">Subtitle</p>
        </div>
        <div id="progress-bg"></div>
        <div id="progress-bar"></div>
    </div>

    <div id="canvas-container"></div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>

    <script>
        // CONFIG
        const memories = [
            { id: 'birthday', title: "The Birthday", sub: "Green Cakes & Red Lights", color: 0xffebee, z: 0, 
              photos: ["10153.jpg", "10157.jpg", "10150.jpg", "10164.jpg"] },
            { id: 'stream', title: "Cheonggyecheon", sub: "Lights, Coughing & Tacos", color: 0xe3f2fd, z: -40, 
              photos: ["11250.jpg", "11253.jpg", "11221.jpg", "11255.jpg", "11215.jpg", "11214.jpg"] },
            { id: 'daegu', title: "Daegu Christmas", sub: "Cozy Winter Vibes", color: 0xe8f5e9, z: -80, 
              photos: ["11525.jpg", "11528.jpg", "11519.jpg", "11547.jpg", "11538.jpg", "11544.jpg"] },
            { id: 'study', title: "Sinchon Scholars", sub: "Notebooks & Sweet Potatoes", color: 0xfff3e0, z: -120, 
              photos: ["11967.jpg", "11964.jpg", "11969.jpg", "11968.jpg"] },
            { id: 'pohang', title: "Pohang Recovery", sub: "From ER to Ocean Blue", color: 0xf3e5f5, z: -160, 
              photos: ["12851.jpg", "12900.jpg", "12913.jpg", "13110.jpg", "13069.jpg", "12969.jpg", "12999.jpg", "13051.jpg", "13098.jpg", "13118.jpg"] }
        ];

        // SETUP
        const scene = new THREE.Scene();
        scene.background = new THREE.Color(0xfdfbfb);
        scene.fog = new THREE.FogExp2(0xfdfbfb, 0.025);
        const camera = new THREE.PerspectiveCamera(50, window.innerWidth/window.innerHeight, 0.1, 1000);
        camera.position.z = 20;
        const renderer = new THREE.WebGLRenderer({antialias:true});
        renderer.setSize(window.innerWidth, window.innerHeight);
        document.getElementById('canvas-container').appendChild(renderer.domElement);
        
        const amb = new THREE.AmbientLight(0xffffff, 0.8); scene.add(amb);
        const dir = new THREE.DirectionalLight(0xffd700, 0.5); dir.position.set(10,20,10); scene.add(dir);

        // LOADER WITH FALLBACK
        const loader = new THREE.TextureLoader();
        const groups = [];

        function logError(msg) {
            const el = document.getElementById('debug-log');
            el.style.display = 'block';
            el.innerHTML += msg + "<br>";
        }

        memories.forEach(mem => {
            const grp = new THREE.Group();
            grp.position.z = mem.z;

            mem.photos.forEach(file => {
                loader.load(file, (tex) => {
                    // Success
                    createMesh(tex, grp, file);
                }, undefined, (err) => {
                    // ERROR: Load Pink Square instead
                    console.log("Error loading " + file);
                    logError("Missing: " + file);
                    const pinkTex = new THREE.TextureLoader().load('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVR42mP8z8BQDwAEhQGAhKmMIQAAAABJRU5ErkJggg=='); // 1x1 Pink Pixel
                    createMesh(pinkTex, grp, file, true);
                });
            });
            scene.add(grp);
            groups.push(grp);
        });

        function createMesh(tex, grp, name, isError=false) {
            const aspect = isError ? 1 : tex.image.width / tex.image.height;
            const w = 5; const h = w / aspect;
            const mat = new THREE.MeshBasicMaterial({ 
                map: tex, 
                side: THREE.DoubleSide,
                color: isError ? 0xff00ff : 0xffffff // Pink if error
            });
            const mesh = new THREE.Mesh(new THREE.PlaneGeometry(w,h), mat);
            mesh.position.set((Math.random()-0.5)*12, (Math.random()-0.5)*6, Math.random()*2);
            mesh.rotation.z = (Math.random()-0.5)*0.3;
            
            // Frame
            const frame = new THREE.Mesh(new THREE.PlaneGeometry(w+0.2, h+0.2), new THREE.MeshBasicMaterial({color:0xffffff}));
            frame.position.z = -0.05; mesh.add(frame);
            
            grp.add(mesh);
        }

        // ANIMATION
        let isStarted = false; let scrollY = 0; let targetZ = 20;
        
        function startGame() {
            isStarted = true;
            targetZ = 10;
            document.getElementById('start-screen').style.display = 'none';
        }

        window.addEventListener('wheel', e => {
            if(!isStarted) return;
            scrollY += e.deltaY * 0.05;
            scrollY = Math.max(0, Math.min(scrollY, 200));
            targetZ = 10 - scrollY;
        });
        
        let ty=0;
        window.addEventListener('touchstart', e=>ty=e.touches[0].clientY);
        window.addEventListener('touchmove', e=>{
            if(!isStarted) return;
            scrollY += (ty - e.touches[0].clientY) * 0.1;
            scrollY = Math.max(0, Math.min(scrollY, 200));
            targetZ = 10 - scrollY;
            ty=e.touches[0].clientY;
        });

        const clock = new THREE.Clock();
        const head = document.getElementById('chap-head');
        const sub = document.getElementById('chap-sub');
        const txt = document.getElementById('chapter-text');
        const bar = document.getElementById('progress-bar');

        function animate() {
            requestAnimationFrame(animate);
            const time = clock.getElapsedTime();
            camera.position.z += (targetZ - camera.position.z) * 0.05;

            if(isStarted) {
                groups.forEach((g,i) => {
                    g.position.y = Math.sin(time + i)*0.5;
                    
                    if(Math.abs(g.position.z - camera.position.z) < 20) {
                        scene.background.lerp(new THREE.Color(memories[i].color), 0.05);
                        scene.fog.color.lerp(new THREE.Color(memories[i].color), 0.05);
                        
                        if(Math.abs(g.position.z - camera.position.z) < 10) {
                            if(head.innerText !== memories[i].title) {
                                txt.classList.remove('active');
                                setTimeout(() => {
                                    head.innerText = memories[i].title;
                                    sub.innerText = memories[i].sub;
                                    txt.classList.add('active');
                                }, 500);
                            } else if (!txt.classList.contains('active')) txt.classList.add('active');
                        }
                    }
                });
                bar.style.height = (scrollY/200)*100 + "%";
            }
            renderer.render(scene, camera);
        }
        animate();
        window.addEventListener('resize', () => {
            camera.aspect = window.innerWidth/window.innerHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(window.innerWidth, window.innerHeight);
        });
    </script>
</body>
</html>
