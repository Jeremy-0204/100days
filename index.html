<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>100 Days with Kaitlin</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Playfair+Display:ital,wght@0,700;1,400&family=Lato:wght@300;400&display=swap');

        body, html {
            margin: 0; padding: 0; width: 100%; height: 100%; overflow: hidden;
            background-color: #fdfbfb; font-family: 'Lato', sans-serif;
        }

        /* --- UI OVERLAYS --- */
        #ui-layer {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%; z-index: 10;
            pointer-events: none; display: flex; justify-content: center; align-items: center;
        }

        /* START SCREEN */
        #start-screen {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%; z-index: 50;
            background: #fff; display: flex; flex-direction: column;
            justify-content: center; align-items: center; transition: opacity 1s;
        }
        #huzzah-btn {
            background: none; border: none; cursor: pointer; pointer-events: auto;
            transition: transform 0.2s;
        }
        #huzzah-btn:hover { transform: scale(1.05); }
        #huzzah-btn img {
            width: 280px; border-radius: 20px; box-shadow: 0 20px 50px rgba(0,0,0,0.15);
        }
        .click-hint {
            margin-top: 25px; font-family: 'Playfair Display', serif; font-style: italic;
            color: #888; font-size: 1.1rem; animation: pulse 2s infinite;
        }

        /* CHAPTER TEXT */
        .chapter-container {
            position: absolute; bottom: 10%; text-align: center; opacity: 0;
            transform: translateY(20px); transition: all 0.8s ease; width: 100%;
        }
        .chapter-container.active { opacity: 1; transform: translateY(0); }
        .chapter-container h2 {
            font-family: 'Playfair Display', serif; font-size: 4rem; margin: 0;
            background: -webkit-linear-gradient(45deg, #333, #666);
            -webkit-background-clip: text; -webkit-text-fill-color: transparent;
            text-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }
        .chapter-container p {
            font-size: 1.1rem; letter-spacing: 4px; text-transform: uppercase;
            color: #d4af37; margin-top: 10px; font-weight: bold;
        }

        /* LETTER MODAL */
        #letter-modal {
            position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%);
            width: 80%; max-width: 600px; background: rgba(255,255,255,0.95);
            padding: 40px; border-radius: 20px; box-shadow: 0 20px 60px rgba(0,0,0,0.2);
            z-index: 100; text-align: center; opacity: 0; pointer-events: none;
            transition: opacity 1s; display: none;
        }
        #letter-modal.visible { opacity: 1; pointer-events: auto; display: block; }
        .letter-content h3 { font-family: 'Playfair Display', serif; font-size: 2.5rem; color: #d4af37; margin-bottom: 20px; }
        .letter-content p { font-size: 1.1rem; line-height: 1.8; color: #444; margin-bottom: 30px; }
        .close-btn {
            background: #d4af37; color: white; border: none; padding: 10px 30px;
            border-radius: 20px; cursor: pointer; font-size: 1rem;
        }

        /* PHOTO ZOOM OVERLAY */
        #zoom-overlay {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.85); z-index: 60; display: none;
            justify-content: center; align-items: center; cursor: zoom-out;
        }
        #zoom-img { max-width: 90%; max-height: 90%; border: 5px solid white; box-shadow: 0 0 50px rgba(0,0,0,0.5); }

        /* PROGRESS */
        #progress-container {
            position: absolute; right: 30px; top: 50%; transform: translateY(-50%);
            height: 200px; width: 3px; background: rgba(0,0,0,0.05);
        }
        #progress-bar { width: 100%; height: 0%; background: #d4af37; transition: height 0.1s; border-radius: 3px; }

        @keyframes pulse { 0% { opacity: 0.6; } 50% { opacity: 1; } 100% { opacity: 0.6; } }
        
        #canvas-container { position: absolute; top: 0; left: 0; width: 100%; height: 100%; z-index: 1; }
    </style>
</head>
<body>

    <div id="start-screen">
        <button id="huzzah-btn">
            <img src="huzzah.gif" alt="HUZZAH" onerror="this.src='https://media.giphy.com/media/MdGZp0GkF2L7i/giphy.gif'">
        </button>
        <div class="click-hint">Click to say "Let's Go" (가자!)</div>
    </div>

    <div id="ui-layer">
        <div id="chapter-text" class="chapter-container">
            <h2 id="chap-head">Title</h2>
            <p id="chap-sub">Subtitle</p>
        </div>
        <div id="progress-container"><div id="progress-bar"></div></div>
    </div>

    <div id="letter-modal">
        <div class="letter-content">
            <h3>Happy 100 Days, Kaitlin</h3>
            <p>
                From that first "HUZZAH" to our quiet moments studying in Sinchon, every day has been an adventure.
                <br><br>
                Even when things were scary in the ER, or cold in Daegu, being with you made it warm.
                You are my favorite person to eat tacos with, to study with, and to build a future with.
                <br><br>
                Here is to 100 days, and thousands more.
                <br>
                I love you.
            </p>
            <button class="close-btn" onclick="document.getElementById('letter-modal').classList.remove('visible')">Close</button>
        </div>
    </div>

    <div id="zoom-overlay">
        <img id="zoom-img" src="">
    </div>

    <div id="canvas-container"></div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/gsap.min.js"></script>

    <script>
        // CONFIG
        // Adjusted Z-positions for better spacing
        const memories = [
            { id: 'birthday', title: "The Birthday", sub: "Green Cakes & Red Lights", color: 0xffebee, z: 0, 
              photos: ["10153.jpg", "10157.jpg", "10150.jpg", "10164.jpg"] },
            { id: 'stream', title: "Cheonggyecheon", sub: "Lights, Coughing & Tacos", color: 0xe3f2fd, z: -40, 
              photos: ["11250.jpg", "11253.jpg", "11221.jpg", "11255.jpg", "11215.jpg", "11214.jpg"] },
            { id: 'daegu', title: "Daegu Christmas", sub: "Cozy Winter Vibes", color: 0xe8f5e9, z: -80, 
              photos: ["11525.jpg", "11528.jpg", "11519.jpg", "11547.jpg", "11538.jpg", "11544.jpg"] },
            { id: 'study', title: "Sinchon Scholars", sub: "Notebooks & Sweet Potatoes", color: 0xfff3e0, z: -120, 
              photos: ["11967.jpg", "11964.jpg", "11969.jpg", "11968.jpg"] },
            { id: 'pohang', title: "Pohang Recovery", sub: "From ER to Ocean Blue", color: 0xf3e5f5, z: -160, 
              photos: ["12851.jpg", "12900.jpg", "12913.jpg", "13110.jpg", "13069.jpg", "12969.jpg", "12999.jpg", "13051.jpg", "13098.jpg", "13118.jpg"] }
        ];

        // SETUP
        const scene = new THREE.Scene();
        scene.background = new THREE.Color(0xfdfbfb);
        scene.fog = new THREE.FogExp2(0xfdfbfb, 0.025); // Lighter fog for better visibility

        const camera = new THREE.PerspectiveCamera(50, window.innerWidth/window.innerHeight, 0.1, 1000);
        camera.position.z = 20;

        const renderer = new THREE.WebGLRenderer({antialias:true, alpha:true});
        renderer.setSize(window.innerWidth, window.innerHeight);
        renderer.shadowMap.enabled = true;
        document.getElementById('canvas-container').appendChild(renderer.domElement);

        // LIGHTS
        const ambientLight = new THREE.AmbientLight(0xffffff, 0.7); // Brighter ambient
        scene.add(ambientLight);
        const dirLight = new THREE.DirectionalLight(0xffd700, 0.8); // Warm sun
        dirLight.position.set(10,20,10); dirLight.castShadow=true; scene.add(dirLight);

        // LOADER
        const loader = new THREE.TextureLoader();
        const groups = [];
        const photoMeshes = []; // Store meshes for interaction

        memories.forEach(mem => {
            const grp = new THREE.Group();
            grp.position.z = mem.z;
            
            mem.photos.forEach(file => {
                loader.load(file, tex => {
                    const aspect = tex.image.width/tex.image.height;
                    const w = 5; const h = w/aspect;
                    const mesh = new THREE.Mesh(new THREE.PlaneGeometry(w,h), new THREE.MeshLambertMaterial({map:tex, side:THREE.DoubleSide}));
                    
                    mesh.position.set((Math.random()-0.5)*14, (Math.random()-0.5)*8, Math.random()*3);
                    mesh.rotation.z = (Math.random()-0.5)*0.4;
                    mesh.castShadow=true; mesh.receiveShadow=true;
                    mesh.userData = { src: file }; // Store URL for zoom

                    const frame = new THREE.Mesh(new THREE.PlaneGeometry(w+0.3, h+0.3), new THREE.MeshBasicMaterial({color:0xffffff}));
                    frame.position.z = -0.05; mesh.add(frame);
                    
                    grp.add(mesh);
                    photoMeshes.push(mesh);
                }, undefined, err => console.log("Missing " + file));
            });

            // Decor: Floating Hearts
            for(let i=0; i<10; i++){
                const shape = new THREE.Shape();
                const x=0, y=0;
                shape.moveTo(x+0.25, y+0.25);
                shape.bezierCurveTo(x+0.25, y+0.25, x+0.20, y, x, y);
                shape.bezierCurveTo(x-0.30, y, x-0.30, y+0.35, x-0.30, y+0.35);
                shape.bezierCurveTo(x-0.30, y+0.55, x-0.10, y+0.77, x+0.25, y+0.95);
                shape.bezierCurveTo(x+0.60, y+0.77, x+0.80, y+0.55, x+0.80, y+0.35);
                shape.bezierCurveTo(x+0.80, y+0.35, x+0.80, y, x+0.50, y);
                shape.bezierCurveTo(x+0.35, y, x+0.25, y+0.25, x+0.25, y+0.25);
                
                const heartGeo = new THREE.ShapeGeometry(shape);
                const heartMat = new THREE.MeshBasicMaterial({color: 0xff69b4, transparent:true, opacity:0.6});
                const heart = new THREE.Mesh(heartGeo, heartMat);
                heart.scale.set(0.5,0.5,0.5);
                heart.position.set((Math.random()-0.5)*25, (Math.random()-0.5)*15, (Math.random()-0.5)*10);
                heart.rotation.z = Math.PI; // Flip upright
                grp.add(heart);
            }
            
            scene.add(grp);
            groups.push(grp);
        });

        // "SWEET POTATO FAIRY" CHARACTER (Simple Representation)
        const fairyGrp = new THREE.Group();
        // Body (Potato)
        const bodyGeo = new THREE.CapsuleGeometry(0.5, 1, 4, 8);
        const bodyMat = new THREE.MeshLambertMaterial({color: 0x8e44ad}); // Purple potato
        const body = new THREE.Mesh(bodyGeo, bodyMat);
        // Head
        const headGeo = new THREE.SphereGeometry(0.4);
        const headMat = new THREE.MeshLambertMaterial({color: 0xffd54f}); // Yellow head
        const head = new THREE.Mesh(headGeo, headMat);
        head.position.y = 0.8;
        // Wings
        const wingGeo = new THREE.CircleGeometry(0.6, 32, 0, Math.PI);
        const wingMat = new THREE.MeshBasicMaterial({color:0xffffff, transparent:true, opacity:0.5, side:THREE.DoubleSide});
        const lWing = new THREE.Mesh(wingGeo, wingMat); lWing.position.set(-0.4, 0.5, -0.2); lWing.rotation.y = 0.5;
        const rWing = new THREE.Mesh(wingGeo, wingMat); rWing.position.set(0.4, 0.5, -0.2); rWing.rotation.y = -0.5;

        fairyGrp.add(body, head, lWing, rWing);
        fairyGrp.position.set(0, -5, -190); // Hidden way back
        scene.add(fairyGrp);


        // INTERACTION: Raycaster for Clicking Photos
        const raycaster = new THREE.Raycaster();
        const mouse = new THREE.Vector2();
        
        window.addEventListener('click', (event) => {
            if(!isStarted) return;
            
            // Calculate mouse position
            mouse.x = (event.clientX / window.innerWidth) * 2 - 1;
            mouse.y = -(event.clientY / window.innerHeight) * 2 + 1;
            
            raycaster.setFromCamera(mouse, camera);
            const intersects = raycaster.intersectObjects(photoMeshes);

            if(intersects.length > 0) {
                const url = intersects[0].object.userData.src;
                const zoomOverlay = document.getElementById('zoom-overlay');
                const zoomImg = document.getElementById('zoom-img');
                zoomImg.src = url;
                zoomOverlay.style.display = 'flex';
            }
        });

        document.getElementById('zoom-overlay').addEventListener('click', () => {
            document.getElementById('zoom-overlay').style.display = 'none';
        });

        // ANIMATION & SCROLL
        let isStarted=false; let scrollY=0; let targetZ=20;
        const maxScroll = 210; // Extended scroll range

        document.getElementById('huzzah-btn').addEventListener('click', () => {
            isStarted=true; targetZ=10;
            document.getElementById('start-screen').style.opacity=0;
            setTimeout(()=>{document.getElementById('start-screen').style.display='none'},1000);
        });

        function handleScroll(delta) {
            if(!isStarted) return;
            scrollY += delta * 0.05;
            scrollY = Math.max(0, Math.min(scrollY, maxScroll));
            targetZ = 10 - scrollY;

            // Trigger Letter at end
            if(scrollY > 190) {
                document.getElementById('letter-modal').classList.add('visible');
                // Move Fairy Up
                gsap.to(fairyGrp.position, {y: 0, duration: 2, ease: "elastic.out(1, 0.5)"});
            }
        }

        window.addEventListener('wheel', e => handleScroll(e.deltaY));
        let ty=0;
        window.addEventListener('touchstart', e=>ty=e.touches[0].clientY);
        window.addEventListener('touchmove', e=>{
            const d = ty - e.touches[0].clientY;
            handleScroll(d * 3);
            ty=e.touches[0].clientY;
        });

        const clock = new THREE.Clock();
        const head = document.getElementById('chap-head');
        const sub = document.getElementById('chap-sub');
        const txt = document.getElementById('chapter-text');
        const bar = document.getElementById('progress-bar');

        function animate(){
            requestAnimationFrame(animate);
            const time = clock.getElapsedTime();
            
            camera.position.z += (targetZ - camera.position.z)*0.05;
            
            // Animate Fairy Wings
            const wingSpeed = time * 15;
            fairyGrp.children[2].rotation.z = Math.sin(wingSpeed)*0.5; // Left Wing
            fairyGrp.children[3].rotation.z = -Math.sin(wingSpeed)*0.5; // Right Wing
            fairyGrp.position.y += Math.sin(time*2)*0.005; // Bobbing

            if(isStarted){
                groups.forEach((g,i)=>{
                    g.position.y = Math.sin(time*0.5 + i)*0.5;
                    g.rotation.z = Math.sin(time*0.1 + i)*0.02;

                    // Text & Color Logic
                    if(Math.abs(g.position.z - camera.position.z) < 20){
                        scene.background.lerp(new THREE.Color(memories[i].color), 0.05);
                        scene.fog.color.lerp(new THREE.Color(memories[i].color), 0.05);
                        
                        if(Math.abs(g.position.z - camera.position.z) < 10){
                            if(head.innerText !== memories[i].title){
                                txt.classList.remove('active');
                                setTimeout(()=>{
                                    head.innerText=memories[i].title;
                                    sub.innerText=memories[i].sub;
                                    txt.classList.add('active');
                                }, 500);
                            } else if(!txt.classList.contains('active')) txt.classList.add('active');
                        }
                    }
                });
                
                const pct = (scrollY/maxScroll)*100;
                bar.style.height = Math.min(pct,100)+"%";
            }
            renderer.render(scene, camera);
        }
        animate();
        window.addEventListener('resize', ()=>{
            camera.aspect=window.innerWidth/window.innerHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(window.innerWidth, window.innerHeight);
        });
    </script>
</body>
</html>